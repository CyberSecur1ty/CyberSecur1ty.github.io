---
layout: post
title: "近源渗透读书笔记"
tags: [NearSource, Pentest, Learn]
comments: true
---


> Author: CyberSecurity   
> Blog: https://1337er.com

## 前言

这本书很早之前就拿到了，最早的时候看到有同事入手了一本，便自己也买了一本，想学习一下新鲜知识，看了几章后发现讲的几乎都是无线安全，与我现在所学内容挂不上钩，便放在墙角吃灰了，后来白帽汇举办了一个"有趣的FOFA"活动，提交FOFA dork(查询语句)，最初连续的三次我都上榜了，FOFA的运营姐姐便给了我近源渗透测试这本书，这样加起来我就有两本了，便想着重拾一下此书，将读书笔记记下，再将自己阅读此书的想法写下来，方便后续复盘;

## 0x00

> **全书共计324页，我打算分为 10 天看完，324/10=32.4，四舍五入一下，一天大概要看32页;**

## 0x01
> ONE DAY

书籍中前言部分主要讲解了中国网络安全史，在早期，国内的**安全研究员**还有一部分专注于研究无线安全的人，当时大多都会采用比较传统的手法进行攻击，慢慢地随着时间的推演，环境越来越完善，直到今天，无线安全渐渐的演化成了**红蓝对抗**，以**红蓝对抗**其中一环的形式存在着(直到如今，还是有很多专注于研究无线安全方面的人员);

针对无线安全的问题，随着无线安全的攻防对抗不断衍生，攻防相互促进，各种技术也得以更加完善;

随着互联网时代这一大背景下的不断演化，攻击者已经很难从外网撕开口子(人性的缺陷, 并未完全泯灭)，而使用近源渗透这一方式，通过近距离与目标接触所采取的渗透方式，(有利也有弊)，如果目标对自身体系采取完全信任的方式(这些地方，确实很容易被忽视，某一线城市三甲医院，外网网站纯静态，内网安全体系情况却很糟糕，终端机沙盒逃逸，弱口令，SQLi，RCE)，攻击者就可以很轻易突破安全防线，这很大程度上会威胁到企业自身的运作;

且随着IoT时代的到来，近源渗透也将目光转移到了物联网硬件上，比如摄像头，饮水机，一切有关于网络通信的硬件设施，都可能成为攻击的对象;

全书内容共7章，第 1 章讲解了作者对于近源渗透的思路以及未来对该领域的展望;
第 2 章讲解无线网络(Wi-Fi)方面的知识, 第 3 到 第 7 章讲解打点成功后的内网渗透知识;

此书所用到的 Github 存储库: https://github.com/PegasusLab/near-source-pentesting-notebook

漫画引用的是《黑客特战队》的第4话 "**近源渗透**"，讲的是通过前期的侦察工作，得知目标公司某高官常常出现在某个场所，通过 RFID 复制目标公司某高官工牌数据，从而进入目标公司建筑群内的某核心机房，将一早准备好的 HID 攻击向量注入到PC中，成功 Get 管理员权限

### 1.1.1

讲述了作者对于渗透测试的理解，以及渗透测试流程，作者理解的渗透测试流程分为3个部分:

> * 分析客户需求以及确认执行规范，签署相关合约;
> * 执行渗透测试流程;
> * 撰写渗透测试报告以及提出相关问题的修复建议;

**更加详细的渗透测试流程**: [PTES](http://www.pentest-standard.org/index.php/Main_Page)

### 1.1.2

此部分讲解了作者对于近源渗透的理解:

近源渗透不同于常规渗透测试，它是指通过近距离与目标接触。利用无线通信技术，物理设备接口，和其它智能设备以及IoT硬件设施的总称;

### 1.1.3

近源渗透的现状:

相比于 10 年前，近源渗透的对象增加无线通信方面的技术，这也是因为 IoT 的高速发展所产生的现状，相比于以前，企业内部或者组织内部增加了许多IoT设备，这些硬件设施在给人们提供高效的工作效率的同时，也潜藏着许多安全隐患;

特别是随着如今的 BYOD 热潮，这确实满足了员工的个性化需求，但也会给安全和企业管理增加新的且更加严峻的问题;

对于企业而言，如今的 IoT 设备给物联网安全带来了严重的挑战，它们自身并没有经过安全的配置，也无法安装 AV(AntiVirus) 等安全程序便于管控，传统的安全策略对于如今的设施束手无策，IT 管理人员也无法全面的发现企业内部所有物联网设备，员工携带的智能设备都处于视野盲区，对于近源渗透而言，通过这些问题进行打点会事半功倍;

### 1.1.4

物联网设备随着科技的高速发展，如今已有特别多的企业或者组织将物联网设备应用于企业内部，以实现业务需求，过不了几年，IoT 的覆盖率将会达到一种新的高度，到那时，安全事件出现的基数将会成倍增长;

而随着智能设备安全风险的增加，越来越多的企业希望将渗透测试服务覆盖到物联网设备环境，发现企业内潜在的安全问题，但是大多数的渗透测试服务并没有配备近源渗透相关的服务，这是一种新的机遇，亦是一种挑战;

### 1.2.1

近源渗透的前期准备，Kali Linux OS, NMap, Wireshark, John the Ripper, Aircrack-NG, Kali Linux 预装了大量渗透测试工具，项目完成后可以重装系统，十分方便;
环境配置方面直接跳过，百度和谷歌有很多教程;

### 1.2.2

无线网卡方面的选择，默认的无线网卡无法开启混杂模式，如果要接收所有报文，就需要可以开启混杂模式的网卡，默认情况下无线网卡与 AP 建立连接后，就处于被管理模式，只会接收发送给自己的数据帧，如果需要无线网卡监听所有通信，则需要将无线网卡设置为监听模式，再使用数据包分析工具(Wireshark, Tcpdump)进行分析，除了被管理模式和监听模式之外，还存在ad hoc模式和主模式(Master mode, 也成为 AP 模式,无线接入点)

在近源渗透中，需要用到支持监听模式和主模式的无线网卡来完成工作，作者推荐的是TP-Link TL-WN722N，Linux 默认安装其驱动，另外一款推荐的无线网卡是Alfa AWUS036ACH，这个无线网卡的驱动需要自行安装;

### 2.1.1

Wi-Fi 所属的 IEEE 802.11，本节讲解 802.11 的工作原理，体系结构，标准定义，加密系统，连接过程，MAC address 随机化技术;

802.11 标准由 IEEE (美国电器和电子工程协会) 管理，由于种种原因，在众多设备制造商的推动下成立了 Wi-Fi 联盟，Wi-Fi 联盟的职责是统一协议，确保所有具有 Wi-Fi 认证标志的产品能共同工作，当 802.11 标准出现模糊的概念时，Wi-Fi 联盟会给出意见，另外，Wi-Fi 联盟允许供应商自行实现一些草案标准，最著名的例子是 WPS;

后面一部分讲解了 Wi-Fi 的基础概念，对这部分感兴趣的同学可以自行收集资料学习;

### 2.1.5

802.11 连接过程:

无线接入点定期对外发送 Beacon 帧宣布AP的存在，智能设备探测到某 AP 的存在，智能设备对 AP 发起认证请求，AP 将认证响应返回给智能设备，智能设备发起关联请求，AP 返回关联响应;

---
**CyberSecurity written on May 10, 2020**
